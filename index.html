<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code to Colored HTML</title>
  <style>
    *{box-sizing:border-box}html,body{margin:0;padding:0}
    body{font:14px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";background:#fff;color:#111}
    header,footer,main{max-width:1000px;margin:24px auto;padding:0 16px}
    header h1{margin:0 0 6px}
    .muted{opacity:.7}
    .card{border:1px solid #e1e4e8;border-radius:12px;padding:12px;margin-bottom:16px;background:#f6f8fa}
    .inline{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .stack{display:flex;flex-direction:column;gap:8px}
    select,button{padding:8px 10px;border:1px solid #e1e4e8;border-radius:8px;background:#fff;color:#111}
    button{cursor:pointer}
    button:hover{filter:brightness(0.98)}
    textarea{width:100%;min-height:180px;resize:vertical;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;font-size:13px;line-height:1.5;padding:10px;border:1px solid #e1e4e8;border-radius:8px;background:#fff;color:#111}
    .preview{overflow:auto;border-radius:8px;border:1px solid #e1e4e8;margin-top:8px}
    pre{margin:0}
    .no-token-bg code.hljs,.no-token-bg code.hljs *{background:transparent!important}
    .no-token-bg code.hljs{padding:0!important;line-height:1!important}
    .controls-justified{justify-content:space-between;width:100%}
    .copy-wrap{text-align:left;margin-top:10px}
  </style>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/cpp.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/dos.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/yaml.min.js"></script>
  <link id="hljsTheme" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/vs.min.css">
</head>
<body>
  <header>
    <h1>Plain-text Code to Colored HTML</h1>
  </header>

  <main>
    <section class="card">
      <div class="stack">
        <div class="stack">
          <label for="lang">Language</label>
          <select id="lang">
            <option value="cpp">C++</option>
            <option value="python">Python</option>
            <option value="bash">Shell (bash)</option>
            <option value="dos">Batch (.bat)</option>
            <option value="yaml">YAML</option>
          </select>
        </div>

        <div class="stack">
          <label for="theme">Theme</label>
          <select id="theme">
            <option value="auto">Auto (language default)</option>
            <option value="default">default</option>
            <option value="github">github</option>
            <option value="github-dark">github-dark</option>
            <option value="atom-one-light">atom-one-light</option>
            <option value="atom-one-dark">atom-one-dark</option>
            <option value="vs">vs</option>
            <option value="vs2015">vs2015</option>
            <option value="monokai">monokai</option>
            <option value="tokyo-night-light">tokyo-night-light</option>
            <option value="tokyo-night-dark">tokyo-night-dark</option>
            <option value="stackoverflow-light">stackoverflow-light</option>
            <option value="stackoverflow-dark">stackoverflow-dark</option>
            <option value="a11y-dark">a11y-dark</option>
            <option value="agate">agate</option>
            <option value="gradient-dark">gradient-dark</option>
            <option value="base16/solarized-light">base16/solarized-light</option>
            <option value="base16/solarized-dark">base16/solarized-dark</option>
          </select>

          <label class="inline" style="gap:6px">
            <input type="checkbox" id="lnToggle" />
            Line numbers
          </label>
        </div>
      </div>
    </section>

    <section class="io">
      <div class="card">
        <label for="source">Input code</label>
        <textarea id="source" placeholder="Paste your code here..." spellcheck="false"></textarea>
      </div>

      <div class="card">
        <div class="inline controls-justified">
          <div class="inline">
            <h2 style="margin:0">Preview</h2>
            <small class="muted">(Outer box background only; no per-line background; tight line spacing)</small>
          </div>
        </div>
        <div id="preview" class="preview"></div>
      </div>

      <div class="card">
        <div class="inline">
          <label for="htmlOut">Generated Body HTML</label>
          <small class="muted">Self-contained snippet, minified (one line); paste directly into your pageâ€™s &lt;body&gt;.</small>
        </div>
        <textarea id="htmlOut" readonly spellcheck="false"></textarea>
        <div class="copy-wrap">
          <button id="copyBtn" type="button">Copy Body HTML</button>
        </div>
      </div>
    </section>
  </main>

  <footer><small class="muted">Export is body-only and standalone. Preview uses official Highlight.js for convenience.</small></footer>

  <script>
    "use strict";

    const els = {
      source: document.getElementById("source"),
      lang: document.getElementById("lang"),
      theme: document.getElementById("theme"),
      out: document.getElementById("htmlOut"),
      preview: document.getElementById("preview"),
      copyBtn: document.getElementById("copyBtn"),
      lnToggle: document.getElementById("lnToggle"),
      themeLink: document.getElementById("hljsTheme"),
    };

    const HLJS_CDN = "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/";
    const defaultThemeByLang = { cpp: "vs", python: "atom-one-light", bash: "github", dos: "github", yaml: "github" };

    function buildThemeHref(name){ return `${HLJS_CDN}${name}.min.css`; }
    function currentThemeName(){ return els.theme.value === "auto" ? (defaultThemeByLang[els.lang.value] || "default") : els.theme.value; }
    function updateThemeLink(done){
      const name = currentThemeName();
      const href = buildThemeHref(name);
      const link = els.themeLink;
      if (link.getAttribute("href") === href) { link.dataset.current = name; if (typeof done === "function") done(); return; }
      link.onload = () => { link.dataset.current = name; if (typeof done === "function") done(); };
      link.onerror = () => { if (typeof done === "function") done(); };
      link.href = href;
    }

    function escapeHtml(s){ return s.replaceAll(/&/g,"&amp;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;"); }

    function injectInlineNumbers(highlightedHTML, codeText){
      const textLines = codeText.replace(/\r\n?/g,"\n").split("\n");
      const htmlLines = highlightedHTML.replace(/\r\n?/g,"\n").split("\n");
      const n = textLines.length;
      const rows = new Array(n);
      for (let i = 0; i < n; i++) {
        const body = htmlLines[i] !== undefined ? htmlLines[i] : "";
        rows[i] = `<span style="opacity:.6;user-select:none;-webkit-user-select:none">${i+1}</span>\u00A0${body}`;
      }
      return rows.join("\n");
    }

    function getHighlightedInner(codeText, lang, withLineNumbers){
      let inner = "";
      try { inner = hljs.highlight(codeText, { language: lang, ignoreIllegals: true }).value; }
      catch { inner = escapeHtml(codeText); }
      if (withLineNumbers) inner = injectInlineNumbers(inner, codeText);
      return inner;
    }

    function measureThemeBackground(lang, inner){
      const holder = document.createElement("div");
      holder.style.cssText = "position:absolute;left:-99999px;top:-99999px;visibility:hidden;";
      holder.innerHTML = `<code class="hljs language-${lang}">${inner}</code>`;
      document.body.appendChild(holder);
      const codeNode = holder.firstElementChild;
      const bg = getComputedStyle(codeNode).backgroundColor;
      document.body.removeChild(holder);
      if (!bg || bg === "rgba(0, 0, 0, 0)" || bg === "transparent") return "#f6f8fa";
      return bg;
    }

    function applyComputedStyles(src, cln){
      const cs = getComputedStyle(src);
      const styles = [];
      const add = (prop, val = cs.getPropertyValue(prop)) => {
        if (!val) return;
        const v = String(val).trim();
        if (!v || v === "normal" || v === "none") return;
        styles.push(`${prop}:${v}`);
      };
      add("color");
      add("font-weight");
      add("font-style");
      const tdec = cs.getPropertyValue("text-decoration");
      if (tdec && tdec !== "none") styles.push(`text-decoration:${tdec}`);
      cln.setAttribute("style", styles.join(";"));
    }

    function cloneWithInlineStyles(sourceEl){
      const cloneEl = sourceEl.cloneNode(true);
      const srcWalker = document.createTreeWalker(sourceEl, NodeFilter.SHOW_ELEMENT, null);
      const cloneWalker = document.createTreeWalker(cloneEl, NodeFilter.SHOW_ELEMENT, null);
      applyComputedStyles(sourceEl, cloneEl);
      while (true) {
        const srcNode = srcWalker.nextNode();
        const clnNode = cloneWalker.nextNode();
        if (!srcNode || !clnNode) break;
        applyComputedStyles(srcNode, clnNode);
      }
      const all = cloneEl.querySelectorAll("[class]");
      all.forEach(n => n.removeAttribute("class"));
      cloneEl.removeAttribute("class");
      return cloneEl;
    }

    function buildBodyOnlySnippet(bgColor, baseColor, inner){
      const codeStyle = "font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,'Liberation Mono',monospace;font-size:13px;white-space:pre;line-height:1;color:"+baseColor+";background-color:transparent";
      const preStyle  = "background-color:"+bgColor+";padding:12px;overflow:auto;margin:0";
      return '<pre style="'+preStyle+'"><code style="'+codeStyle+'">'+inner+"</code></pre>";
    }

    function buildPreviewHtml(bg, lang, inner){
      return `<pre class="no-token-bg" style="padding:12px;overflow:auto;margin:0;background-color:${bg}"><code class="hljs language-${lang}" style="font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,'Liberation Mono',monospace;font-size:13px;white-space:pre;line-height:1;">${inner}</code></pre>`;
    }

    function updatePreviewAndOutput(){
      updateThemeLink(() => {
        const lang = els.lang.value;
        const codeText = els.source.value || "";
        const withLn = els.lnToggle.checked;
        const inner = getHighlightedInner(codeText, lang, withLn);
        const themeBG = measureThemeBackground(lang, inner);
        const previewHtml = buildPreviewHtml(themeBG, lang, inner);
        els.preview.innerHTML = previewHtml;
        const codeEl = els.preview.querySelector("code");
        const clonedCode = cloneWithInlineStyles(codeEl);
        const baseColor = getComputedStyle(codeEl).color || "#111";
        const snippet = buildBodyOnlySnippet(themeBG, baseColor, clonedCode.innerHTML);
        els.out.value = snippet;
      });
    }

    function attachEventHandlers(){
      els.lang.addEventListener("change", updatePreviewAndOutput);
      els.theme.addEventListener("change", updatePreviewAndOutput);
      els.lnToggle.addEventListener("change", updatePreviewAndOutput);
      els.source.addEventListener("input", updatePreviewAndOutput);
      els.copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(els.out.value);
          const original = els.copyBtn.textContent;
          els.copyBtn.textContent = "Copied!";
          setTimeout(() => els.copyBtn.textContent = original, 1000);
        } catch {
          els.out.select();
          document.execCommand("copy");
        }
      });
    }

    function setStarterExample(){
      els.source.value = `#include <iostream>
int main() {
  std::cout << "Hello, world!\\n";
  return 0;
}`;
    }

    function init(){
      setStarterExample();
      attachEventHandlers();
      updatePreviewAndOutput();
    }

    init();
  </script>
</body>
</html>
